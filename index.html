<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check Your Wallet – Expense Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Chart.js (More stable than Recharts for CDN usage) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { font-family: 'Inter', sans-serif; }
      /* Hide scrollbar for clean UI */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-presets="env,react">
      const { useState, useEffect, useMemo, useRef } = React;
      const { createRoot } = ReactDOM;

      // --- UTILS & CONSTANTS ---
      const uuidv4 = () => {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      };

      const CATEGORIES = ['Food', 'Travel', 'Shopping', 'Bills', 'Entertainment', 'Other'];
      
      const CURRENCIES = [
        { code: 'USD', symbol: '$', name: 'US Dollar' },
        { code: 'EUR', symbol: '€', name: 'Euro' },
        { code: 'GBP', symbol: '£', name: 'British Pound' },
        { code: 'INR', symbol: '₹', name: 'Indian Rupee' },
        { code: 'JPY', symbol: '¥', name: 'Japanese Yen' },
        { code: 'CAD', symbol: 'C$', name: 'Canadian Dollar' },
        { code: 'AUD', symbol: 'A$', name: 'Australian Dollar' },
        { code: 'CNY', symbol: '¥', name: 'Chinese Yuan' },
        { code: 'CHF', symbol: 'Fr', name: 'Swiss Franc' },
        { code: 'BRL', symbol: 'R$', name: 'Brazilian Real' },
        { code: 'RUB', symbol: '₽', name: 'Russian Ruble' },
        { code: 'KRW', symbol: '₩', name: 'South Korean Won' },
        { code: 'MXN', symbol: 'Mx$', name: 'Mexican Peso' },
        { code: 'SAR', symbol: '﷼', name: 'Saudi Riyal' },
        { code: 'ZAR', symbol: 'R', name: 'South African Rand' },
        { code: 'TRY', symbol: '₺', name: 'Turkish Lira' },
        { code: 'SEK', symbol: 'kr', name: 'Swedish Krona' },
        { code: 'NOK', symbol: 'kr', name: 'Norwegian Krone' },
        { code: 'DKK', symbol: 'kr', name: 'Danish Krone' },
        { code: 'SGD', symbol: 'S$', name: 'Singapore Dollar' },
        { code: 'HKD', symbol: 'HK$', name: 'Hong Kong Dollar' },
        { code: 'NZD', symbol: 'NZ$', name: 'New Zealand Dollar' },
        { code: 'IDR', symbol: 'Rp', name: 'Indonesian Rupiah' },
        { code: 'MYR', symbol: 'RM', name: 'Malaysian Ringgit' },
        { code: 'PHP', symbol: '₱', name: 'Philippine Peso' },
        { code: 'THB', symbol: '฿', name: 'Thai Baht' },
        { code: 'VND', symbol: '₫', name: 'Vietnamese Dong' },
        { code: 'PLN', symbol: 'zł', name: 'Polish Zloty' },
      ];

      // --- ICON COMPONENT (Inline SVG to avoid library crashes) ---
      const Icons = {
        Wallet: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>,
        Globe: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>,
        Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
        Coins: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>,
        CreditCard: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>,
        PlusCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>,
        AlertCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
        Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
        Filter: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
        Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
        Receipt: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z"/><path d="M16 8h-6"/><path d="M16 12h-6"/><path d="M16 16h-6"/></svg>,
        Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
        ShoppingBag: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
        Plane: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h5"/><path d="M13 12h3"/><path d="M4 17h22a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z"/><path d="M8 12a4 4 0 1 1-4-4"/></svg>, // Simple placeholder
        Clapperboard: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.2 6 3 11l-.9-2.4c-.5-1.1.2-2.4 1.3-2.9l13.2-4.8c1.1-.5 2.4.2 2.9 1.3l.7 1.8Z"/><path d="m6.2 5.3 3.1 3.9"/><path d="m12.4 3.4 3.1 4"/><path d="M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z"/></svg>,
        HelpCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
      };
      
      const IconWrapper = ({ name, size = 20, className = "" }) => {
        const Icon = Icons[name] || Icons.HelpCircle;
        return (
          <span className={`inline-flex items-center justify-center ${className}`} style={{ width: size, height: size }}>
            {React.cloneElement(Icon(), { width: size, height: size })}
          </span>
        );
      };

      // --- STORAGE SERVICE ---
      const STORAGE_KEY = 'buckwheat_expenses';
      const CURRENCY_KEY = 'buckwheat_currency';

      const getExpenses = () => {
        try {
          const stored = localStorage.getItem(STORAGE_KEY);
          return stored ? JSON.parse(stored) : [];
        } catch (e) {
          console.error("Failed to load expenses", e);
          return [];
        }
      };

      const saveExpenses = (expenses) => {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
        } catch (e) {
          console.error("Failed to save expenses", e);
        }
      };

      const getCurrencyCode = () => {
        try {
          return localStorage.getItem(CURRENCY_KEY) || 'USD';
        } catch (e) {
          return 'USD';
        }
      };

      const saveCurrencyCode = (code) => {
        try {
          localStorage.setItem(CURRENCY_KEY, code);
        } catch (e) {
          console.error("Failed to save currency", e);
        }
      };

      // --- COMPONENTS ---

      // SummaryCards
      const SummaryCards = ({ totalOverall, totalMonth, count, currencySymbol }) => {
        return (
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4 transition-transform hover:-translate-y-1 duration-300">
              <div className="p-3 bg-indigo-50 text-indigo-600 rounded-full">
                <IconWrapper name="Calendar" size={24} />
              </div>
              <div>
                <p className="text-sm font-medium text-slate-500">This Month</p>
                <h3 className="text-2xl font-bold text-slate-800">{currencySymbol}{totalMonth.toFixed(2)}</h3>
              </div>
            </div>

            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4 transition-transform hover:-translate-y-1 duration-300">
              <div className="p-3 bg-emerald-50 text-emerald-600 rounded-full">
                <IconWrapper name="Coins" size={24} />
              </div>
              <div>
                <p className="text-sm font-medium text-slate-500">Total Spent</p>
                <h3 className="text-2xl font-bold text-slate-800">{currencySymbol}{totalOverall.toFixed(2)}</h3>
              </div>
            </div>

            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4 transition-transform hover:-translate-y-1 duration-300">
              <div className="p-3 bg-amber-50 text-amber-600 rounded-full">
                <IconWrapper name="CreditCard" size={24} />
              </div>
              <div>
                <p className="text-sm font-medium text-slate-500">Total Transactions</p>
                <h3 className="text-2xl font-bold text-slate-800">{count}</h3>
              </div>
            </div>
          </div>
        );
      };

      // ExpenseForm
      const ExpenseForm = ({ onAddExpense, currencySymbol }) => {
        const [amount, setAmount] = useState('');
        const [category, setCategory] = useState('Food');
        const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
        const [note, setNote] = useState('');
        const [error, setError] = useState(null);

        const handleSubmit = (e) => {
          e.preventDefault();
          setError(null);

          const numAmount = parseFloat(amount);
          if (isNaN(numAmount) || numAmount <= 0) {
            setError('Please enter a valid positive amount.');
            return;
          }
          if (!date) {
            setError('Please select a date.');
            return;
          }

          const newExpense = {
            id: uuidv4(),
            amount: numAmount,
            category,
            date,
            note: note.trim(),
          };

          onAddExpense(newExpense);
          setAmount('');
          setNote('');
        };

        return (
          <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
            <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
              <IconWrapper name="PlusCircle" size={20} className="text-indigo-600" />
              Add New Expense
            </h2>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-slate-600 mb-1">Amount ({currencySymbol})</label>
                  <input
                    type="number"
                    step="0.01"
                    value={amount}
                    onChange={(e) => setAmount(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                    placeholder="0.00"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-slate-600 mb-1">Category</label>
                  <select
                    value={category}
                    onChange={(e) => setCategory(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white transition-all"
                  >
                    {CATEGORIES.map((c) => (
                      <option key={c} value={c}>{c}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <div>
                  <label className="block text-sm font-medium text-slate-600 mb-1">Date</label>
                  <input
                    type="date"
                    value={date}
                    onChange={(e) => setDate(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-slate-600 mb-1">Note (Optional)</label>
                  <input
                    type="text"
                    value={note}
                    onChange={(e) => setNote(e.target.value)}
                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all"
                    placeholder="Lunch, taxi, etc."
                  />
                </div>
              </div>

              {error && (
                <div className="flex items-center gap-2 text-red-500 text-sm bg-red-50 p-2 rounded-lg">
                  <IconWrapper name="AlertCircle" size={16} />
                  {error}
                </div>
              )}

              <button
                type="submit"
                className="w-full bg-indigo-600 text-white font-semibold py-2.5 rounded-lg hover:bg-indigo-700 active:scale-[0.99] transition-all shadow-md shadow-indigo-200"
              >
                Add Expense
              </button>
            </form>
          </div>
        );
      };

      // ExpenseList
      const getCategoryIconName = (category) => {
        switch (category) {
          case 'Food': return 'Coffee';
          case 'Shopping': return 'ShoppingBag';
          case 'Travel': return 'Plane';
          case 'Bills': return 'Receipt';
          case 'Entertainment': return 'Clapperboard';
          default: return 'HelpCircle';
        }
      };

      const getCategoryColor = (category) => {
         switch (category) {
          case 'Food': return 'text-orange-600 bg-orange-50';
          case 'Shopping': return 'text-blue-600 bg-blue-50';
          case 'Travel': return 'text-sky-600 bg-sky-50';
          case 'Bills': return 'text-red-600 bg-red-50';
          case 'Entertainment': return 'text-purple-600 bg-purple-50';
          default: return 'text-slate-600 bg-slate-100';
        }
      }

      const ExpenseList = ({ expenses, onDeleteExpense, currencySymbol }) => {
        if (expenses.length === 0) {
          return (
            <div className="bg-white p-12 rounded-xl shadow-sm border border-slate-100 text-center flex flex-col items-center justify-center h-full">
              <div className="bg-slate-50 p-4 rounded-full mb-4">
                <IconWrapper name="Receipt" size={48} className="text-slate-300" />
              </div>
              <h3 className="text-lg font-semibold text-slate-700">No expenses found</h3>
              <p className="text-slate-500 mt-1">Adjust your filters or add a new expense to get started.</p>
            </div>
          );
        }

        return (
          <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full text-left border-collapse">
                <thead>
                  <tr className="bg-slate-50 border-b border-slate-200">
                    <th className="py-4 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider">Date</th>
                    <th className="py-4 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider">Category</th>
                    <th className="py-4 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider">Note</th>
                    <th className="py-4 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right">Amount</th>
                    <th className="py-4 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right">Action</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-100">
                  {expenses.map((expense) => (
                    <tr key={expense.id} className="hover:bg-slate-50 transition-colors group">
                      <td className="py-4 px-6 text-sm text-slate-600 whitespace-nowrap">
                        {new Date(expense.date).toLocaleDateString()}
                      </td>
                      <td className="py-4 px-6 text-sm">
                        <span className={`inline-flex items-center gap-2 px-2.5 py-1 rounded-full text-xs font-medium ${getCategoryColor(expense.category)}`}>
                          <IconWrapper name={getCategoryIconName(expense.category)} size={18} />
                          {expense.category}
                        </span>
                      </td>
                      <td className="py-4 px-6 text-sm text-slate-600 max-w-xs truncate">
                        {expense.note || <span className="text-slate-300 italic">No notes</span>}
                      </td>
                      <td className="py-4 px-6 text-sm font-semibold text-slate-800 text-right">
                        {currencySymbol}{expense.amount.toFixed(2)}
                      </td>
                      <td className="py-4 px-6 text-right">
                        <button
                          onClick={() => onDeleteExpense(expense.id)}
                          className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all opacity-0 group-hover:opacity-100 focus:opacity-100"
                          title="Delete Expense"
                        >
                          <IconWrapper name="Trash2" size={16} />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      };

      // ExpenseChart (Using Chart.js)
      const ExpenseChart = ({ expenses, currencySymbol }) => {
        const canvasRef = useRef(null);
        const chartInstanceRef = useRef(null);

        const data = useMemo(() => {
          const map = new Map();
          expenses.forEach((e) => {
            const current = map.get(e.category) || 0;
            map.set(e.category, current + e.amount);
          });

          // Sort by value desc
          return Array.from(map.entries())
            .map(([name, value]) => ({ name, value }))
            .filter(item => item.value > 0)
            .sort((a, b) => b.value - a.value);
        }, [expenses]);

        useEffect(() => {
          if (!canvasRef.current) return;

          // Destroy previous chart
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }

          if (data.length === 0) return;

          const ctx = canvasRef.current.getContext('2d');
          
          const CHART_COLORS = {
            Food: '#f97316', // Orange 500
            Travel: '#0ea5e9', // Sky 500
            Shopping: '#2563eb', // Blue 600
            Bills: '#dc2626', // Red 600
            Entertainment: '#9333ea', // Purple 600
            Other: '#64748b', // Slate 500
          };

          const labels = data.map(d => d.name);
          const values = data.map(d => d.value);
          const backgroundColors = labels.map(label => CHART_COLORS[label] || '#cbd5e1');

          chartInstanceRef.current = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: labels,
              datasets: [{
                data: values,
                backgroundColor: backgroundColors,
                borderWidth: 0,
                hoverOffset: 4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    usePointStyle: true,
                    boxWidth: 10,
                    padding: 20,
                    font: { family: "'Inter', sans-serif", size: 12 }
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      let label = context.label || '';
                      if (label) {
                        label += ': ';
                      }
                      if (context.parsed !== null) {
                        label += currencySymbol + context.parsed.toFixed(2);
                      }
                      return label;
                    }
                  },
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  titleColor: '#1e293b',
                  bodyColor: '#475569',
                  borderColor: '#e2e8f0',
                  borderWidth: 1,
                  padding: 10,
                  displayColors: true,
                  boxPadding: 4
                }
              },
              cutout: '65%',
            }
          });

          return () => {
            if (chartInstanceRef.current) {
              chartInstanceRef.current.destroy();
            }
          };
        }, [data, currencySymbol]);

        if (data.length === 0) {
          return (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-80 flex items-center justify-center text-slate-400 text-sm">
              Not enough data to display chart.
            </div>
          );
        }

        return (
          <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-96 flex flex-col">
            <h3 className="text-lg font-bold text-slate-800 mb-4">Expenses by Category</h3>
            <div className="flex-1 w-full min-h-0 relative">
              <canvas ref={canvasRef}></canvas>
            </div>
          </div>
        );
      };

      // FilterBar
      const FilterBar = ({ filters, onFilterChange }) => {
        const handleMonthChange = (e) => {
          onFilterChange({ ...filters, month: e.target.value });
        };

        const handleCategoryChange = (e) => {
          onFilterChange({ ...filters, category: e.target.value });
        };

        const handleSearchChange = (e) => {
          onFilterChange({ ...filters, search: e.target.value });
        };

        return (
          <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex flex-col md:flex-row gap-4 items-center justify-between">
            <div className="flex items-center gap-2 text-slate-500 font-medium">
              <IconWrapper name="Filter" size={18} />
              <span>Filters</span>
            </div>

            <div className="flex flex-col md:flex-row gap-3 w-full md:w-auto">
              <input
                type="month"
                value={filters.month}
                onChange={handleMonthChange}
                className="px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-700 bg-white"
              />

              <select
                value={filters.category}
                onChange={handleCategoryChange}
                className="px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-700 bg-white"
              >
                <option value="All">All Categories</option>
                {CATEGORIES.map((c) => (
                  <option key={c} value={c}>{c}</option>
                ))}
              </select>

              <div className="relative">
                <input
                  type="text"
                  placeholder="Search notes..."
                  value={filters.search}
                  onChange={handleSearchChange}
                  className="pl-9 pr-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-700 w-full md:w-48"
                />
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                  <IconWrapper name="Search" size={16} />
                </div>
              </div>
            </div>
          </div>
        );
      };

      // App
      const App = () => {
        const [expenses, setExpenses] = useState([]);
        const [currencyCode, setCurrencyCode] = useState(getCurrencyCode());
        const [filters, setFilters] = useState(() => {
          const now = new Date();
          const monthStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
          return {
            month: monthStr,
            category: 'All',
            search: '',
          };
        });

        const currency = useMemo(() => {
          return CURRENCIES.find(c => c.code === currencyCode) || CURRENCIES[0];
        }, [currencyCode]);

        useEffect(() => {
          const loaded = getExpenses();
          setExpenses(loaded);
        }, []);

        const handleCurrencyChange = (e) => {
          const newCode = e.target.value;
          setCurrencyCode(newCode);
          saveCurrencyCode(newCode);
        };

        const handleAddExpense = (newExpense) => {
          const updated = [newExpense, ...expenses];
          setExpenses(updated);
          saveExpenses(updated);
        };

        const handleDeleteExpense = (id) => {
          const updated = expenses.filter((e) => e.id !== id);
          setExpenses(updated);
          saveExpenses(updated);
        };

        const filteredExpenses = useMemo(() => {
          return expenses.filter((expense) => {
            if (!expense.date.startsWith(filters.month)) return false;
            if (filters.category !== 'All' && expense.category !== filters.category) return false;
            if (filters.search) {
              const searchLower = filters.search.toLowerCase();
              const noteMatch = expense.note.toLowerCase().includes(searchLower);
              if (!noteMatch) return false;
            }
            return true;
          }).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
        }, [expenses, filters]);

        const summary = useMemo(() => {
          const totalOverall = expenses.reduce((sum, e) => sum + e.amount, 0);
          const currentMonthTotal = expenses
            .filter(e => e.date.startsWith(filters.month))
            .reduce((sum, e) => sum + e.amount, 0);

          return { totalOverall, currentMonthTotal };
        }, [expenses, filters.month]);

        return (
          <div className="min-h-screen pb-12">
            <header className="bg-white border-b border-slate-200 sticky top-0 z-10">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className="bg-indigo-600 p-2 rounded-lg text-white">
                    <IconWrapper name="Wallet" size={24} />
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-slate-800 leading-tight">Check Your Wallet</h1>
                    <p className="text-xs text-slate-500 font-medium">Track your spending, simply.</p>
                  </div>
                </div>
                
                <div className="flex items-center gap-2">
                  <div className="hidden sm:flex items-center gap-1 text-slate-400 text-sm mr-2">
                    <IconWrapper name="Globe" size={14} />
                    <span>Currency</span>
                  </div>
                  <select 
                    value={currencyCode} 
                    onChange={handleCurrencyChange}
                    className="bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2 outline-none cursor-pointer hover:bg-slate-100 transition-colors"
                  >
                    {CURRENCIES.map(c => (
                      <option key={c.code} value={c.code}>
                        {c.code} ({c.symbol})
                      </option>
                    ))}
                  </select>
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <SummaryCards 
                totalOverall={summary.totalOverall} 
                totalMonth={summary.currentMonthTotal}
                count={filteredExpenses.length}
                currencySymbol={currency.symbol}
              />

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-1 space-y-6">
                   <ExpenseForm onAddExpense={handleAddExpense} currencySymbol={currency.symbol} />
                   <FilterBar filters={filters} onFilterChange={setFilters} />
                   <div className="hidden lg:block">
                     <ExpenseChart expenses={filteredExpenses} currencySymbol={currency.symbol} />
                   </div>
                </div>

                <div className="lg:col-span-2 space-y-6">
                  <div className="lg:hidden">
                     <ExpenseChart expenses={filteredExpenses} currencySymbol={currency.symbol} />
                  </div>
                  
                  <div className="flex items-center justify-between mb-2">
                    <h2 className="text-xl font-bold text-slate-800">Transactions</h2>
                    <span className="text-sm text-slate-500">
                      {new Date(filters.month).toLocaleDateString(undefined, { month: 'long', year: 'numeric', timeZone: 'UTC' })}
                    </span>
                  </div>

                  <ExpenseList 
                    expenses={filteredExpenses} 
                    onDeleteExpense={handleDeleteExpense} 
                    currencySymbol={currency.symbol}
                  />
                </div>
              </div>
            </main>

            <footer className="max-w-7xl mx-auto px-4 py-6 text-center text-slate-400 text-sm border-t border-slate-200 mt-8">
              Check Your Wallet – Expense Tracker | Mini Project
            </footer>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>